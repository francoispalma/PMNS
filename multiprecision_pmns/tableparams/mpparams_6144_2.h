#define N 60
#define NBCHUNKS 2
#define LAMBDA 2
#define RHOver2 55

static const uint64_t RHOhi = 2904022541868076u;

static const int64_t M[2][119] = { {
		12514838381715944, 3044248415299216, 16016635371737918, 10978457605935292, 26480251257728266, 10435744830321204, 13892890189907408, 34836523244577266, 34677761672654780, 4793350951491396, 34025243796281636, 12605825525143028, 2573682566496528, 31335494081686434, 12937713001255138, 10360714286781738, 25485960908075070, 35090224145151192, 3020656364491772, 28263761588099720, 24879727984196152, 27683624116688, 8739766368000274, 33347306669372776, 32482048124386226, 19350625054123154, 20928920302834188, 3179205979090518, 33331780655811084, 27612728241409020, 12243725128479588, 16285561226913724, 693817647501020, 25003547864250032, 2814250119873426, 14476522362589668, 33931508976002750, 3499017863859338, 34261541774467320, 4748129705344442, 35684533642331876, 9099954524061010, 2818205827133366, 21265089883056092, 25680319807703130, 5039029821999004, 2805067516097428, 2734718994957664, 15832002784040102, 22546181645706184, 34001497821674072, 24847675195831386, 17480828616820440, 31275077279813366, 35277567579754854, 14693026703487472, 25899511944271860, 21473273923828608, 29635472984310782, 623202079574257, 24271817700339956, 1522124207649608, 8008317685868959, 5489228802967646, 31254524138346117, 5217872415160602, 6946445094953704, 35432660131770617, 17338880836327390, 2396675475745698, 35027020407622802, 24317311272053498, 19301239792730248, 33682145550325201, 6468856500627569, 23194755652872853, 12742980454037535, 35559510582057580, 1510328182245886, 32146279303531844, 30454262501580060, 13841812058344, 4369883184000137, 16673653334686388, 16241024062193113, 27689711036543561, 28478858660899078, 1589602989545259, 16665890327905542, 13806364120704510, 24136261073721778, 26157179122938846, 346908823750510, 30516172441607000, 19421523569418697, 7238261181294834, 16965754488001375, 19763907441411653, 17130770887233660, 20388463362154205, 17842266821165938, 4549977262030505, 1409102913566683, 10632544941528046, 12840159903851565, 20533913420481486, 1402533758048714, 19381758006960816, 7916001392020051, 29287489332335076, 17000748910837036, 12423837597915693, 8740414308410220, 15637538639906683, 35653182299359411, 25360911861225720, 30964154481617914, 28751035471396288, 14817736492155391
	}, {
-4240731718579, 40651363158498, -226999289192978, 9274927867792, -5871290192963, 80548163853926, -84292644121372, -204324131696065, -123187581888916, -137949860081376, -55298472921413, 77864936748193, -99734719393657, -203936275173859, 7642026089132, -31011349658377, -120383246379042, -183791032252591, -257737014762304, 297841247022955, -53714978398123, 18062695835216, 80462830276646, 49393865540662, 12984093842048, 258983633085851, 8637621242201, 182658948572548, -266537865396312, -63653831257002, -176574767153523, -165684013924957, 37502107316516, -67338218228215, -16446752623617, -6774224075104, -246060999651572, 199201409396593, 194689894987096, -23213635737359, 168966499103332, 27152551306282, 100910921919550, -39970360851220, -117048763187784, 76888432141941, 34680135767128, -2309049136613, -79371604247726, -82063223277883, -69849204922842, -26681123442158, 89256749053242, 172213627496212, -14743661667383, 216056028435865, -46216747153603, -14090142839365, 37354910160112, 11064656910773, -2120365859290, 20325681579249, -113499644596489, 4637463933896, -2935645096482, 40274081926963, -42146322060686, -102162065848033, -61593790944458, -68974930040688, -27649236460707, 38932468374096, -49867359696829, -101968137586930, 3821013044566, -15505674829189, -60191623189521, -91895516126296, -128868507381152, 148920623511477, -26857489199062, 9031347917608, 40231415138323, 24696932770331, 6492046921024, 129491816542925, 4318810621100, 91329474286274, -133268932698156, -31826915628501, -88287383576762, -82842006962479, 18751053658258, -33669109114108, -8223376311809, -3387112037552, -123030499825786, 99600704698296, 97344947493548, -11606817868680, 84483249551666, 13576275653141, 50455460959775, -19985180425610, -58524381593892, 38444216070970, 17340067883564, -1154524568307, -39685802123863, -41031611638942, -34924602461421, -13340561721079, 44628374526621, 86106813748106, -7371830833692, 108028014217932, -23108373576802, -7045071419683, 18677455080056
} };

static const int64_t M1[] = {
9018541451041688, 31220022104627360, 3607346539529810, 31308068006432564, 3693282468433270, 28657907015887466, 33348565901386704, 35426275151399410, 10008436048338854, 4281326639149262, 15581973352736862, 33175729766854786, 25909465789346558, 12100336304065356, 13546563397443034, 32709011642117856, 35766599006329240, 4594427401603276, 26396705263083130, 8712931461522494, 26387096193388594, 34879793028107352, 11209599778731324, 18794413401412494, 16560156980037268, 30492300981266294, 19146632990079780, 11863557762764086, 4828311767450264, 31141349028577094, 27205955666636542, 13796343858539368, 22554823870725440, 17900608093051068, 2404551702165664, 264035727245798, 19829401040829956, 12950084772233474, 17865844845725886, 27162849323049298, 22743128480393316, 16412209159886136, 2221010318871578, 34202619644884732, 34153035366466338, 25912206167515390, 35622520374083584, 31586348854267744, 22106365600002574, 23534815634217826, 10962895646826916, 18207740112157138, 33690118168654892, 26697007215518804, 3819767705348144, 31277250716928578, 34071480829634752, 25002969286490872, 28251800034749554, 31552664824560259, 4509270725520844, 33624409561795664, 19818071779246889, 33668432512698266, 19861039743698619, 32343352017425717, 34688681460175336, 17713137575699705, 23018616533651411, 2140663319574631, 25805385185850415, 34602263392909377, 30969131404155263, 24064566661514662, 24787680208203501, 34368904330540912, 17883299503164620, 2297213700801638, 13198352631541565, 22370864240243231, 13193548096694297, 35454295023535660, 23619198398847646, 9397206700706247, 8280078490018634, 15246150490633147, 9573316495039890, 5931778881382043, 20428554393207116, 33585073023770531, 31617376342800255, 24912570438751668, 29291810444844704, 26964702556007518, 19216674360564816, 132017863622899, 9914700520414978, 24489440895598721, 26947320932344927, 31595823171006633, 29385962749678642, 8206104579943068, 19124903668917773, 17101309822442366, 17076517683233169, 12956103083757695, 17811260187041792, 15793174427133872, 11053182800001287, 11767407817108913, 5481447823413458, 27118268565560553, 34859457593809430, 31362902117241386, 1909883852674072, 33653023867946273, 35050138924299360, 30515883152727420, 14125900017374777
};

static const int64_t M0m0m1[59] = { -12028092571860368, 14763437019264116, -7314500038367939, 19514319061282386, -28440274018472691, 9258649947429066, 26985063881049046, -31933642267911279, 16922660938139930, 2351454229598744, 657513234709074, -15217356747992488, -16483033965596882, -12417055667269109, 19211463307075561, -18155725830873849, -9937912937940107, -32824791587099916, 14321674601794216, -9600097657825660, 3547235320094012, 24833833383773042, 13110945432820303, 14601423945126978, 19036543517561741, -12996684333056089, -2579346716627218, 19883670934283349, 12969582656405240, -13183162041130253, 135556626618178, -24635054915289238, 7661408862118449, -25026943638639354, 11833000568927420, -2020388766134232, -10019309393047671, 15668752690358964, 208109949093730, -17991787886408507, 17184753586456864, 19767334010022993, 17892136879163565, 23049600608797155, -6371303403223996, 2660842232391367, 11340446695988821, 16177752575096764, -6405673209774165, 2858789971196768, 13453513590743024, -12409995785857349, -4370531124410083, 1036114694779705, -19412158237166298, 2328799175317841, -2485295820718836, -27161432481851029, 1848153835750151 };

static const int64_t M0m0m2[59] = { -271113253236356, 13241312811614508, -15322817724236898, 14025090258314740, -23666001137854840, 4040777532268464, 20038618786095342, -31337505380717928, -416219898187460, -45221246146954, 1659289846050240, -3505871001082018, 244523260636838, -10070404198630342, 12742606806447992, -5321684464782734, -22680893391977642, -32355505150193528, 12811346419548330, -5717579942393536, 9121769837477920, 24819991571714698, 8741062248820166, -2072229389559410, 2795519455368628, -4657598350635682, 4970591641437672, 18294067944738090, -3696307671500302, -26989526161834763, 12028092571860368, -14763437019264116, 7314500038367939, -19514319061282386, 28440274018472691, -9258649947429066, -26985063881049046, 31933642267911279, -16922660938139930, -2351454229598744, -657513234709074, 15217356747992488, 16483033965596882, 12417055667269109, -19211463307075561, 18155725830873849, 9937912937940107, 32824791587099916, -14321674601794216, 9600097657825660, -3547235320094012, -24833833383773042, -13110945432820303, -14601423945126978, -19036543517561741, 12996684333056089, 2579346716627218, -19883670934283349, -12969582656405240 };

static const int64_t M1m0m1[59] = { -174454401294233, -186009695504206, 151001751913005, -71975682162111, -13511107527135, -47048306002067, -203914677590886, 301363475244626, 256283685931554, 45761294303329, 196615735564039, -11779917067814, 150778281616379, 61997776735710, -120869776232350, 92394106971130, 94871758956649, 89586466989683, 49496903133426, -230983846789360, -42991715723780, -35712471359766, 49025333914919, 147516694725881, -21235708588407, 86564211892940, -50535557774703, -105419617125639, 170623842858268, 42891572539274, 86167017717472, 103167688541728, -132250698254747, 38306573048004, 5287731215327, 43661193964515, 80884177765100, -201762770546329, -158938738438006, -57368112172008, -112132486012373, 25356192720955, -100322820656604, -81982957161320, 62345394638458, -53949890900159, -77531691073085, -90740991557989, -89182705257289, 189952235150419, 8067113262359, 22371909638687, -4396959388298, -61409880977775, 13863877754716, 21463802324993, 27427184197902, 98374545705957, -151946387778212 };

static const int64_t M1m0m2[59] = { -172334035434944, -206335377083455, 264501396509494, -76613146096007, -10575462430654, -87322387929030, -161768355530200, 403525541092658, 317877476876012, 114736224344017, 224264972024745, -50712385441911, 200645641313207, 163965914322639, -124690789276916, 107899781800318, 155063382146170, 181481983115978, 178365410514578, -379904470300838, -16134226524719, -44743819277374, 8793918776596, 122819761955550, -27727755509431, -42927604649986, -54854368395804, -196749091411913, 303892775556424, 74718488167775, 174454401294233, 186009695504206, -151001751913005, 71975682162111, 13511107527135, 47048306002067, 203914677590886, -301363475244626, -256283685931554, -45761294303329, -196615735564039, 11779917067814, -150778281616379, -61997776735710, 120869776232350, -92394106971130, -94871758956649, -89586466989683, -49496903133426, 230983846789360, 42991715723780, 35712471359766, -49025333914919, -147516694725881, 21235708588407, -86564211892940, 50535557774703, 105419617125639, -170623842858268 };

static const int64_t M1_m0m1[59] = { -13332112077848270, 16200731315707672, 2736752091478551, 20260972599316770, 18572308977431013, 3949480728784049, -14859280419345380, -4763052803466231, 30876025331038443, -11006611015489301, -3062256705457099, 17838742785940727, 7280675933680283, 10138052983370070, 9365355158262837, -8456698163025522, -18289576148045004, -6739661865497862, -27120784050502959, 1163951393974595, -2230652449867381, -17246554911378522, 10070919769807246, -18728996504151411, -4460310784670490, -19997696792668537, -11530632684369106, -16957606613855139, 7823245641542438, -2032408199210272, 8920691401684557, 8711839123043996, -9473738665597815, 6703729956690748, 644365383133803, -3817462865161150, -11254816079203610, 29252493699064952, -3928704398693516, 6573637167531966, -3580577563828227, -9632638205997659, 11844227735237490, -29065540179891672, -28317634493993636, -14615995772180751, 72039316122828, -13495960726332234, 2145169831540278, -25425340595829650, 7712100273280839, 8336026457975107, -11240259194961784, 14063101602428829, 6370194637344562, 17621923641650842, 10551974589704498, 11444692747618591, -29726142643131629 };

static const int64_t M1_m0m2[59] = { -17841382803369114, 18605118772875976, -17081319687768338, 22621337105582472, -1288730766267606, 7634925730322300, -13519164860556748, 13552606639798032, 7857408797387032, -13147274335063932, -28867641891307514, 19265276411995318, 12340341548488988, -13926513678144592, -15422325049940664, -6796805474602466, -144078632245656, -9036875566299500, -4290339663080556, -21206912846268636, 20604596472402290, -16672052915950214, -13548278629040400, 7902593814106310, -12740389274689124, 784949735662284, 14924847839554972, -22889385495237182, -12605308751664678, 411315795983165, 13332112077848270, -16200731315707672, -2736752091478551, -20260972599316770, -18572308977431013, -3949480728784049, 14859280419345380, 4763052803466231, -30876025331038443, 11006611015489301, 3062256705457099, -17838742785940727, -7280675933680283, -10138052983370070, -9365355158262837, 8456698163025522, 18289576148045004, 6739661865497862, 27120784050502959, -1163951393974595, 2230652449867381, 17246554911378522, -10070919769807246, 18728996504151411, 4460310784670490, 19997696792668537, 11530632684369106, 16957606613855139, -7823245641542438 };

static inline void mtoep8(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	SCHOOLBOOK(N/12)

static inline void m1toep8(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1SCHOOLBOOK(N/12)


static inline void mtoep9(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP33TOP(N/4, mtoep8)

static inline void m1toep9(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP33TOP(N/4, m1toep8)


static inline void mtoep10(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP22TOP(N/2, mtoep9)

static inline void m1toep10(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP22TOP(N/2, m1toep9)


static inline void toeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP22TOP(N, mtoep10)

static inline void ptoeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	pTOEP22TOP(N, mtoep10)

static inline void m1toep20(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP22TOP(N, m1toep10)


static inline void mtoeplitz_vm0(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[0] + N/2);
	mtoep10(t1, vect, M0m0m1);
	mtoep10(t2, vect + N/2, M0m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


static inline void mtoeplitz_vm1(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[1] + N/2);
	mtoep10(t1, vect, M1m0m1);
	mtoep10(t2, vect + N/2, M1m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


// Utility function to extract the lower 64 bits of each vector coefficient
static inline void m1toeplitz_vm(int64_t* restrict rop, const __int128* restrict vect)
{
	int64_t t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2], v[N];
	for(int i = 0; i < N/2; i++)
	{
		v[i] = vect[i];
		v[i + N/2] = vect[i + N/2];
		v0p1[i] = v[i] + v[i + N/2];
	}
	m1toep10(t0, v0p1, M1 + N/2);
	m1toep10(t1, v, M1_m0m1);
	m1toep10(t2, v + N/2, M1_m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}

void (* const multbym[2]) (__int128* restrict rop, const int64_t* restrict vect) = { mtoeplitz_vm0, mtoeplitz_vm1 };

