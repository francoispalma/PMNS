#define N 27
#define NBCHUNKS 4
#define LAMBDA 2
#define RHOver2 59

static const uint64_t RHOhi = 8603003571660182u;

static const int64_t M[4][53] = { {
		286353291623707644, 455816897596559176, 275771417869700332, 135059763135481102, 243428865419373586, 553887282027554050, 360514291404267872, 235995083742407654, 407464599829715562, 331647531834715736, 242909569014553168, 253540400200989916, 490482966313199270, 213770302777504402, 125772135517915734, 117553716395502508, 315370060942622722, 6882885823410424, 87872314732233362, 223963659993680002, 78662468918092490, 507751054513238522, 171201353040480404, 559402123160864112, 308340083681131912, 458753846510240750, 240967081515646081, 143176645811853822, 516138824949991332, 137885708934850166, 355760257719452295, 121714432709686793, 565174017165488769, 180257145702133936, 117997541871203827, 491962676066569525, 454054142069069612, 121454784507276584, 415000576252206702, 533471859308311379, 106885151388752201, 351116443910669611, 58776858197751254, 157685030471311361, 3441442911705212, 43936157366116681, 400212206148551745, 327561610610757989, 542105903408331005, 85600676520240202, 279701061580432056, 154170041840565956, 229376923255120375
	}, {
		511848811573860380, 68008112697277171, 369460531753878836, 131185613151501815, 369797070594393214, 318275128588897113, 465475606096184344, 460643178139710056, 339026343292249997, 301965216116055715, 227964127830067306, 490978852758981369, 77896173036450187, 285469670652608574, 244399020166608189, 377333856272425244, 546980797350184792, 265519703494270736, 539141799134352310, 354507279754043363, 73971634147467159, 514090707953702531, 415062606926828904, 464372086988837610, 352047411765904440, 322935686883654478, 129163539432196620, 255924405786930190, 34004056348638585, 184730265876939418, 65592806575750907, 184898535297196607, 447367940446160300, 520968179199803916, 518551965221566772, 457743547797836742, 150982608058027857, 402212440066745397, 245489426379490684, 38948086518225093, 430965211478016031, 122199510083304094, 188666928136212622, 273490398675092396, 420990227898847112, 557801275718887899, 465484016028733425, 325216193225445323, 257045353976851265, 495761679615126196, 232186043494418805, 176023705882952220, 449698219593538983
	}, {
		562767404034351552, 13463220604921736, 177150800995005406, 523643167886478314, 299470901294735356, 191650470126485235, 206779792242639011, 300171609568918787, 336605116532063629, 499104697664990460, 283343456893319943, 149270153861787300, 245211631614764332, 362124262818990797, 236399574012997722, 103057102912613120, 242231274867525206, 85232942205170629, 550388561588886803, 202525807198906933, 363983464767005179, 385359891659077864, 72331023418929201, 178806684187047198, 231513479277689964, 265543723948508013, 481544363723708834, 569614078168887520, 294961986454172612, 88575400497502703, 261821583943239157, 437965826799079422, 95825235063242617, 391620272273031249, 150085804784459393, 456532934417743558, 249552348832495230, 429902104598371715, 362865453082605394, 122605815807382166, 181062131409495398, 118199787006498861, 51528551456306560, 409346013585474347, 42616471102585314, 563424656946155145, 389493279751165210, 470222108535214333, 480910321981250676, 36165511709464600, 377633718245235343, 403987115790556726, 421002238125965750
	}, {
1324015543124151, 1054603983983047, -2420367394204532, -245051873812102, -193842850991175, 1292424187166130, 164573361138967, 140471833075624, 493177062973051, -261525746799432, 1056636682421001, 853576047488539, -56292849975532, 1108394086903606, 141118724918834, 734838384685052, -145802859819567, -1136485095323946, 280162446190623, 35360846101537, 337439481973085, -876286500120219, -1429167298490200, -193056797386727, -511002832407795, 567092072046307, -153240299799582, 662007771562075, 527301991991523, -1210183697102266, -122525936906051, -96921425495588, 646212093583065, 82286680569483, 70235916537812, 246588531486525, -130762873399716, 528318341210500, 426788023744269, -28146424987766, 554197043451803, 70559362459417, 367419192342526, -72901429909784, -568242547661973, 140081223095311, 17680423050768, 168719740986542, -438143250060110, -714583649245100, -96528398693364, -255501416203898, 283546036023153
} };

static const int64_t M1[] = {
175277477482383096, 326474339795649256, 74409166744454124, 148609284992950346, 87460873448982, 241457443104212938, 441720817623465572, 403896294530180252, 18702859500190050, 99651390397503986, 500127772190354060, 544213067377663592, 533896546781725412, 242600055048582618, 279696702782662192, 81508232840633114, 155256904987158586, 86301403359865758, 558057980872761140, 492818058074373022, 513649230522790170, 376614976591505722, 56241626731103590, 251565530020197242, 131592820492417512, 553872230063856336, 195766207685644579, 87638738741191548, 451467546049536372, 37204583372227062, 74304642496475173, 288274106588436235, 408959097703818213, 509090784963444530, 490178523416801870, 297581805901806769, 49825695198751993, 538294262246888774, 272106533688831796, 555178649542574450, 409530403676003053, 139848351391331096, 40754116420316557, 77628452493579293, 331381077831644623, 279028990436380570, 246409029037186511, 256824615261395085, 476537864447464605, 28120813365551795, 125782765010098621, 65796410246208756, 276936115031928168
};

static inline void mtoep9(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	SCHOOLBOOK(N/9)

static inline void m1toep9(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1SCHOOLBOOK(N/9)


static inline void mtoep10(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP33TOP(N/3, mtoep9)

static inline void m1toep10(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP33TOP(N/3, m1toep9)


static inline void toeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP33TOP(N, mtoep10)

static inline void ptoeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	pTOEP33TOP(N, mtoep10)

static inline void m1toep20(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP33TOP(N, m1toep10)


static inline void mtoeplitz_vm0(__int128* restrict rop, const int64_t* restrict vect)
{
	toeplitz_vm(rop, vect, M[0]);
}



static inline void mtoeplitz_vm1(__int128* restrict rop, const int64_t* restrict vect)
{
	toeplitz_vm(rop, vect, M[1]);
}



static inline void mtoeplitz_vm2(__int128* restrict rop, const int64_t* restrict vect)
{
	toeplitz_vm(rop, vect, M[2]);
}



static inline void mtoeplitz_vm3(__int128* restrict rop, const int64_t* restrict vect)
{
	toeplitz_vm(rop, vect, M[3]);
}



static inline void m1toeplitz_vm(int64_t* restrict rop, const __int128* restrict vect)
{
	int64_t v[N];
	for(int i = 0; i < N; i++)
		v[i] = vect[i];
	m1toep20(rop, v, M1);
}


void (* const multbym[4]) (__int128* restrict rop, const int64_t* restrict vect) = { mtoeplitz_vm0, mtoeplitz_vm1, mtoeplitz_vm2, mtoeplitz_vm3 };

