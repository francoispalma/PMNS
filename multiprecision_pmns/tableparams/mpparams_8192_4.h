#define N 36
#define NBCHUNKS 4
#define LAMBDA 2
#define RHOver2 59

static const uint64_t RHOhi = 13014743465090420u;

static const int64_t M[4][71] = { {
		230342801591367786, 552727719555914378, 222257140412885426, 502869476845438514, 512933337628327896, 459046473996392154, 255147021075621330, 323887365333857444, 393065029727525612, 392443436009720400, 187223230258961082, 290711134820074656, 22604815832607572, 38858735574378280, 459980224743751196, 463612774931684348, 286716431329103828, 210209927143539616, 130192058186742590, 354696642836621928, 351973956994158408, 434101912399795768, 230668792592083756, 468857346978164706, 208504844524839132, 372526470569355972, 329852948136133008, 48664409080368754, 105609131734671620, 180392454206221516, 95121904153646836, 16402094166294230, 552420905956566972, 16885515072381012, 66299857309093632, 164692712767037169, 115171400795683893, 276363859777957189, 111128570206442713, 539665114574431001, 256466668814163948, 229523236998196077, 127573510537810665, 450174058818640466, 484762891015474550, 196221718004860200, 93611615129480541, 433585943561749072, 11302407916303786, 19429367787189140, 229990112371875598, 520036763617553918, 431588591816263658, 105104963571769808, 65096029093371295, 177348321418310964, 175986978497079204, 217050956199897884, 403564772447753622, 522659049640794097, 392482798414131310, 186263235284677986, 453156850219778248, 312562580691896121, 52804565867335810, 378426603254822502, 47560952076823418, 8201047083147115, 564440829129995230, 296673133687902250, 33149928654546816
	}, {
		111649256512282558, 124799936405977128, 246529306389515942, 479690478881843249, 250335150501527214, 67308499383701716, 363976520400457976, 215789278353902549, 53302416629081477, 285442049393552992, 46838594060464380, 81218992751547815, 131912706060591988, 233603238783913482, 340271125489299236, 420306556058353809, 226303726250280307, 511502600905007118, 68324933689235244, 372340839603844792, 386417393075221916, 75163044102051878, 570987571884413739, 404162938549228873, 432996759928582309, 524509073931989716, 83007395930088247, 502272188831207659, 175623708810405276, 554863299381149205, 135546908662992634, 430005113626599290, 500012475625217049, 398000161715546613, 406042717729439806, 373613806738108270, 344055004407853023, 350630344354700308, 123264653194757971, 239845239440921624, 125167575250763607, 33654249691850858, 181988260200228988, 107894639176951274, 314881584466252482, 430951400848488240, 23419297030232190, 328839872527485651, 65956353030295994, 405031995543668485, 458365938896361362, 498383654180888648, 401382239276851897, 255751300452503559, 322392842996329366, 474400795953634140, 481439072689322702, 325811898202737683, 285493785942206869, 490311845426326180, 504728756116002898, 550484913117706602, 41503697965044123, 539366470567315573, 376042230556914382, 277431649690574602, 356003830483208061, 215002556813299645, 538236613964320268, 199000080857773306, 203021358864719903
	}, {
		56847122858636397, 240050003034135489, 424836843879359316, 85282370002007614, 196539329075709212, 153209398924583582, 546697596684399066, 104526392659673984, 152857197249841975, 568209772969507115, 153083419205403556, 65203457023566273, 202098157283427268, 322195337730986173, 90096408710532279, 494397420911380981, 7573655576896175, 300907447009285592, 533333341567131941, 569282184379696487, 369058177712359579, 252859174571094489, 347437411121374632, 173454215947474979, 165169842755215405, 44713267641278607, 348771628120644340, 45050416122729611, 235107143717486987, 123865041611605926, 432920386668491811, 181768518556981130, 314665909034784595, 100691149284397396, 567220573541144094, 506923477770515051, 316653937581029942, 120025001517067744, 212418421939679658, 42641185001003807, 98269664537854606, 76604699462291791, 273348798342199533, 340493572481548736, 364658974776632731, 572335262636465301, 364772085754413522, 32601728511783136, 101049078641713634, 449328045017204830, 333278580506977883, 535429086607402234, 292017203940159831, 438684099656354540, 554897046935277714, 284641092189848243, 184529088856179789, 126429587285547244, 173718705560687316, 374957484125449233, 370815297529319446, 22356633820639303, 462616190212033914, 22525208061364805, 117553571858743493, 350162896957514707, 216460193334245905, 379114635430202309, 157332954517392297, 338575950793910442, 571840662922283791
	}, {
432317919933517, -557469876751764, -560843582357886, 541435215163760, -707232698675972, -1620357424390288, 837038384115630, -501754220039193, 142379766843725, -3182860149846147, -1418565307712115, -13443123158012, -346975661184972, -905709927524749, 538259107315435, -500440147749993, 417757165872269, -168288400836481, -28035185642921, 1652472003014920, 503445749006612, 1834144538078214, 1289696357737352, 1934656415267263, 1129586398641643, -520886057998600, 979352176876825, 79374039761748, 1123184133035210, -387001650175059, -748090969301534, -18745811793479, 6363105043556, -214511228456431, -109859038239581, -76953992637989, 216158959966758, -278734938375882, -280421791178943, 270717607581880, -353616349337986, -810178712195144, 418519192057815, -250877110019597, 71189883421862, -1591430074923074, -709282653856058, -6721561579006, -173487830592486, -452854963762375, 269129553657717, -250220073874997, 208878582936134, -84144200418241, -14017592821461, 826236001507460, 251722874503306, 917072269039107, 644848178868676, 967328207633631, 564793199320821, -260443028999300, 489676088438412, 39687019880874, 561592066517605, -193500825087530, -374045484650767, -9372905896740, 3181552521778, -107255614228216, -54929519119791
} };

static const int64_t M1[] = {
350686262107008026, 337153039229015288, 169094780000867352, 400991388608392592, 477638833218216930, 72513172307652612, 195816471409554806, 522687105633199814, 187741848957500670, 277774239044664354, 200340713084925828, 230357304416797690, 415158151604679376, 138619409741667620, 134956066917771486, 480387114144024414, 498111966065183058, 260387844073651734, 385623565032735886, 412085233256046540, 473258645260314478, 488231714707830506, 179960569472337504, 208297038161063244, 362789178397363550, 398110732993673498, 570917098852341762, 546890241262159292, 145682120999213460, 383470993723511334, 501552002864950830, 170960918530884794, 485144929526096278, 290866400049849058, 206146350861155296, 435730838094971455, 175343131053504013, 456806895766219388, 372777766152145420, 488726070455908040, 527049792760820209, 36256586153826306, 97908235704777403, 549573928968311651, 382101300630462079, 427117495674043921, 100170356542462914, 115178652208398845, 495809451954051432, 69309704870833810, 67478033458885743, 240193557072012207, 537286359184303273, 130193922036825867, 481042158668079687, 494272992779735014, 524859698781868983, 244115857353915253, 378210660887880496, 392378895232243366, 181394589198681775, 199055366496836749, 285458549426170881, 561675496782791390, 361071436651318474, 191735496861755667, 539006377584187159, 373710835417154141, 530802840914759883, 145433200024924529, 391303551582289392
};

static const int64_t M0m0m1[35] = { 15020657391058697, 78332783058664739, 240845386787715695, -105563202174635233, -25797876222080192, 239334109979968629, 80931333987028467, -77647588249284494, -154909942879341542, -147557308924491446, 11997516605191079, -253193489355527556, 83819496237343050, -3027273620894910, 322430793584691374, -503151248545172906, -365288734507170026, 59587749195267361, 50075371702312598, 99015538359646225, -64858408290636491, 322614158374533117, -147098103633589674, -293135812642598020, -264909287876320645, 263910823533962480, 31606040795696302, -116340862687035921, 40807049262144731, 55159340306926570, -36258544160519632, 11228320704042025, -334450716758119632, 223363629929651668, 398438663161716842 };

static const int64_t M0m0m2[35] = { -100150743404625196, -198031076719292450, 129716816581272982, -68767564445642746, -282264545036244140, 9810872981772552, -46642176550782198, 48639105235498528, -63212081591392604, -343779026929351646, -81614098524289462, -110318680613853140, 72517088321039264, -22456641408084050, 92440681212815776, -446727259859303336, -220416574020010196, -45517214376502447, -15020657391058697, -78332783058664739, -240845386787715695, 105563202174635233, 25797876222080192, -239334109979968629, -80931333987028467, 77647588249284494, 154909942879341542, 147557308924491446, -11997516605191079, 253193489355527556, -83819496237343050, 3027273620894910, -322430793584691374, 503151248545172906, 365288734507170026 };

static const int64_t M1m0m1[35] = { -275730070718617779, 21710495249144484, 263152739880463945, -164682195338869746, 445819996633650132, 370508688857378015, 251008499728353321, 416614434755038442, -231874188536164235, 71320787982719419, 152204411780173086, 226023426853663554, 69590555632696640, 24973118082930805, 41646536728855687, -100383492465342035, 4660478452587909, 117862506285604711, 21662161411523657, -123770451598933832, -358174419494564731, -85966658761816059, -160326210691443262, -456657595734475322, -322740495915773910, -442590273940755328, 273377886501208359, -108415069718827333, -352622933526682192, 51408222836911049, -290047477452912067, 190029438730368840, -79870675067958906, 299383573323115342, 198360880412131994 };

static const int64_t M1m0m2[35] = { -43324322823047314, 247540903197867664, 139888086685705974, -404527434779791371, 320652421382886525, 336854439165527157, 69020239528124333, 308719795578087167, 29704979301006770, 216830139437654667, 128785114749940896, 473644306629601390, 3634202602400646, 196401874842685808, 159741350135917813, -22306394342807196, 179738991479159499, -137888794166898848, 275730070718617779, -21710495249144484, -263152739880463945, 164682195338869746, -445819996633650132, -370508688857378015, -251008499728353321, -416614434755038442, 231874188536164235, -71320787982719419, -152204411780173086, -226023426853663554, -69590555632696640, -24973118082930805, -41646536728855687, 100383492465342035, -4660478452587909 };

static const int64_t M2m0m1[35] = { 216679403986101999, 449257182862628743, 156639755772679921, 210217989570090682, 249167746583520026, 96849516485183188, -108178955586984128, -295780304840270129, -15887346655988391, -527284846513735690, -129664942036926535, 91263313099822790, 331871308026778177, -267559526460223700, -18612671472193288, -434737937323004838, 275203369600984263, 68239378114160511, -238243109354247772, -164616090672780499, 27889333083499869, -83788402284543437, -75449041022832710, -298352784663157442, -97466499187119913, 318136938660909433, -97957215435401183, 549810054575100496, 247218513895670029, -317561168445731571, -115411114692532271, 70213409587002521, 175945625989585586, 196853135813491792, -279823458982123960 };

static const int64_t M2m0m2[35] = { 476486218708495544, 329232181345560998, -55778666166999737, 167576804569086875, 150898082045665420, 20244817022891397, -381527753929183661, -59813125018395377, 195914430870802365, -523159356846777504, 82023724512083431, 58661584588039653, 230822229385064543, -140426819174005043, 224569500324252316, -393706271626983585, 559646917964247919, 206016030761229459, -216679403986101999, -449257182862628743, -156639755772679921, -210217989570090682, -249167746583520026, -96849516485183188, 108178955586984128, 295780304840270129, 15887346655988391, 527284846513735690, 129664942036926535, -91263313099822790, -331871308026778177, 267559526460223700, 18612671472193288, 434737937323004838, -275203369600984263 };

static const int64_t M3m0m1[35] = { -244194145609679, 1931206941390802, 783867540185555, 1563426930496334, 1643312707075338, 2744835127462407, 711067206583828, -270008947979003, 908162293454963, 1670804114684822, 1832466786891268, -380280088596053, -574603138709048, 434109151968896, -262766448614161, 35708845418566, -318737621175715, 7190207780252, 230176552788219, -1104970939883342, -532144665682249, -646354661457227, -998464528206662, -1777506919828775, -146274007263006, 9565918979703, -418486205016550, -1631117094803948, -1270874720373663, 186779263508524, 200557654058281, -443482057865635, 265948001135939, -142964459646781, 263808102055925 };

static const int64_t M3m0m2[35] = { -460353105576438, 2209941879766684, 1064289331364498, 1292709322914454, 1996929056413324, 3555013839657551, 292548014526013, -19131837959407, 836972410033100, 3262234189607895, 2541749440747325, -373558527017047, -401115308116562, 886964115731270, -531896002271879, 285928919293562, -527616204111850, 91334408198492, 244194145609679, -1931206941390802, -783867540185555, -1563426930496334, -1643312707075338, -2744835127462407, -711067206583828, 270008947979003, -908162293454963, -1670804114684822, -1832466786891268, 380280088596053, 574603138709048, -434109151968896, 262766448614161, -35708845418566, 318737621175715 };

static const int64_t M1_m0m1[35] = { -366180318324191615, -44721662510172848, 100480879108169058, -494355748077534, 229371529014940783, 172040452007236938, -311579809610837341, -151463195974638153, 188815798221879683, 119772745588115371, 45511764456750546, -308168410788310999, 5742550910899398, 101651213660050984, -158793856236212953, -525787909325586637, 245320743980275511, -270923836245277900, 270761724688847814, -37466097013515626, -152081932629723563, -331850539201430701, 148839131872939713, 220338443225006428, -83486353493904372, -225942189831948586, -479818001099132290, -134558001108747469, 315559672194567928, -76556844653356822, -43196925630135727, 272059621757103157, 113135944847549348, 94760357047087678, 145982807602013881 };

static const int64_t M1_m0m2[35] = { 34937302925727860, 74932194027031252, -272296887043976362, 87240326099437914, 278782488557544062, 135783865853410632, -409488045315614744, -124576372639526316, -193285502408582396, -307344750085928550, -54658592085712368, -423347062996709844, 86393851260271454, 32341508789217174, -226271889695098696, -189520714094175356, 284495137099395726, -401117758282103767, 366180318324191615, 44721662510172848, -100480879108169058, 494355748077534, -229371529014940783, -172040452007236938, 311579809610837341, 151463195974638153, -188815798221879683, -119772745588115371, -45511764456750546, 308168410788310999, -5742550910899398, -101651213660050984, 158793856236212953, 525787909325586637, -245320743980275511 };

static inline void mtoep9(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	SCHOOLBOOK(N/6)

static inline void m1toep9(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1SCHOOLBOOK(N/6)


static inline void mtoep10(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP33TOP(N/2, mtoep9)

static inline void m1toep10(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP33TOP(N/2, m1toep9)


static inline void toeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP22TOP(N, mtoep10)

static inline void ptoeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	pTOEP22TOP(N, mtoep10)

static inline void m1toep20(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP22TOP(N, m1toep10)


static inline void mtoeplitz_vm0(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[0] + N/2);
	mtoep10(t1, vect, M0m0m1);
	mtoep10(t2, vect + N/2, M0m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


static inline void mtoeplitz_vm1(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[1] + N/2);
	mtoep10(t1, vect, M1m0m1);
	mtoep10(t2, vect + N/2, M1m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


static inline void mtoeplitz_vm2(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[2] + N/2);
	mtoep10(t1, vect, M2m0m1);
	mtoep10(t2, vect + N/2, M2m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


static inline void mtoeplitz_vm3(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[3] + N/2);
	mtoep10(t1, vect, M3m0m1);
	mtoep10(t2, vect + N/2, M3m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


// Utility function to extract the lower 64 bits of each vector coefficient
static inline void m1toeplitz_vm(int64_t* restrict rop, const __int128* restrict vect)
{
	int64_t t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2], v[N];
	for(int i = 0; i < N/2; i++)
	{
		v[i] = vect[i];
		v[i + N/2] = vect[i + N/2];
		v0p1[i] = v[i] + v[i + N/2];
	}
	m1toep10(t0, v0p1, M1 + N/2);
	m1toep10(t1, v, M1_m0m1);
	m1toep10(t2, v + N/2, M1_m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}

void (* const multbym[4]) (__int128* restrict rop, const int64_t* restrict vect) = { mtoeplitz_vm0, mtoeplitz_vm1, mtoeplitz_vm2, mtoeplitz_vm3 };

