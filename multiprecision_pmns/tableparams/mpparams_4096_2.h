#define N 40
#define NBCHUNKS 2
#define LAMBDA 2
#define RHOver2 55

static const uint64_t RHOhi = 1400505015598294u;

static const int64_t M[2][79] = { {
		6757920312518576, 29927341229892892, 29168744360064522, 11078279441089588, 23203846964669752, 4108840481068178, 6407607207304308, 2958356301308814, 33150439280323962, 5822202053742382, 1614056803713844, 31828885561757574, 26096109146788994, 5458450744861436, 9103311990605776, 15532204782005352, 14621770966953378, 27993444695202114, 33424764242913692, 21373808096853686, 24175823161461516, 2676044484906462, 18072444922179248, 5165252688111924, 11739906196516674, 22038237886410512, 6124024563866026, 18836440920438466, 30038053815658582, 27102334944418242, 7719471634937476, 27670988605514966, 22497344426214790, 23471588247445176, 27873818190176868, 10039253096859118, 35964701109490368, 14107626998806080, 11555482504912880, 3109672045656753, 21393358665741272, 32978069124428430, 14584372180032261, 23553538230026778, 29616321991816860, 2054420240534089, 21218202113134138, 1479178150654407, 34589618149643965, 2911101026871191, 807028401856922, 15914442780878787, 13048054573394497, 2729225372430718, 22566054504784872, 7766102391002676, 25325283992958673, 32011120857083041, 34726780630938830, 28701302557908827, 30102310090212742, 1338022242453231, 27050620970571608, 20597024853537946, 23884351607740321, 11019118943205256, 21076410791414997, 27432618969701217, 33033425417311275, 13551167472209121, 3859735817468738, 31849892812239467, 11248672213107395, 11735794123722588, 13936909095088434, 5019626548429559, 35996749064227168, 25068212008885024, 5777741252456440
	}, {
-46543397726991, -53960961380913, 77565343292520, -113238154355923, -27286025970869, 64121561700764, 17833409299485, -40894161684740, -15102364297619, 92215160663728, 43226581320432, -35985616444656, 81596983861940, 28327419777230, -22821716138937, 150411853210804, -55297817844299, -85702049506215, 8832795790841, -77660021755299, 19617893590717, -65594026739870, 137710618092199, 102655454791263, 116200102219883, -110579745242954, -151085832160581, -144820895430429, 114616854889375, 72023437606204, 272606600592668, 32459368838715, -23035004317544, 11516855567076, -114094675862432, 18040942912592, 36816771645443, 582627430697, 33167398411410, 85161528830331, -23271698863496, -26980480690457, 38782671646260, -56619077177962, -13643012985435, 32060780850382, 8916704649742, -20447080842370, -7551182148810, 46107580331864, 21613290660216, -17992808222328, 40798491930970, 14163709888615, -11410858069469, 75205926605402, -27648908922150, -42851024753108, 4416397895420, -38830010877650, 9808946795358, -32797013369935, 68855309046099, 51327727395631, 58100051109941, -55289872621477, -75542916080291, -72410447715215, 57308427444687, 36011718803102, 136303300296334, 16229684419357, -11517502158772, 5758427783538, -57047337931216, 9020471456296, 18408385822721, 291313715348, 16583699205705
} };

static const int64_t M1[] = {
27014433399748432, 14167754184477068, 14805741697779658, 26515083973017672, 27117447294172164, 16387181942094944, 23915123654186352, 24909755604294750, 32120108594839424, 16806451131257438, 27427885334780288, 20727987059759404, 26732771902360182, 17782074229868134, 20659771885262666, 20521068030534980, 17999301487549778, 10345265384215004, 29944704348104748, 19129326297501456, 28994697984423264, 35692354393180840, 23805564870635520, 16920711581761188, 28033741663429384, 915840905821952, 19971915385051782, 4549326864624794, 13473280122768428, 34226373875887382, 18340257299972728, 24657922177716850, 2459016317233930, 32123994952914602, 4586257696037476, 22392016683535364, 19673036178011062, 32528684646958312, 31611312742793318, 25244804394628695, 31521615209356200, 25098275601720518, 7402870848889829, 31271940495990820, 13558723647086082, 26207989480529456, 11957561827093176, 30469276311629359, 16060054297419712, 8403225565628719, 31728341176872128, 28378392039361686, 31380784460662075, 8891037114934067, 10329885942631333, 10260534015267490, 8999650743774889, 5172632692107502, 14972352174052374, 27579061658232712, 14497348992211632, 17846177196590420, 29917180944799744, 26474754300362578, 14016870831714692, 18472318962392960, 28000356202007875, 20289061941794381, 24751038570866198, 17113186937943691, 9170128649986364, 12328961088858425, 1229508158616965, 16061997476457301, 20307527357500722, 29210406851249666, 27850916598487515, 16264342323479156, 15805656371396659
};

static const int64_t M0m0m1[39] = { 2782464495720244, -30302024639521968, 3488072742146987, -18388285541914854, -17876415795300186, 19983817645876423, -15094177549268112, 17357262769784059, -4551564333985383, 24191233917547051, 6912443233080554, 11756545824636179, 9449289852820293, 20742362875014458, 5307763685391996, 2273150705856442, 10639417116531695, -17903493858276961, -23171298126025950, -25591630512252074, -8708951424471470, 31640046881975199, -12466248790539347, 2956513376488832, 5731970384076539, -8964698702671167, 141791321719141, -25953440819046810, 1556192732332690, -10640066445337930, -3052707415611816, -15935450031360680, 1799382360287102, -9006568751291870, 8629145409696438, 2746475842573117, -10671465071268495, 6942908848198017, 28949039378482390 };

static const int64_t M0m0m2[39] = { 17417902848942940, -27251296744986430, -11096299437885274, -5913026752977664, -11463940768153078, 17929397405342334, -283582643438282, 15878084619129652, -3112385464665380, 21280132890675860, 6105414831223632, -4157896956242608, -3598764720574204, 18013137502583740, 18770506199571092, -5492951685146234, 21342930142536990, -13885817696396034, -21869281738000812, -18264136051196933, -2782464495720244, 30302024639521968, -3488072742146987, 18388285541914854, 17876415795300186, -19983817645876423, 15094177549268112, -17357262769784059, 4551564333985383, -24191233917547051, -6912443233080554, -11756545824636179, -9449289852820293, -20742362875014458, -5307763685391996, -2273150705856442, -10639417116531695, 17903493858276961, 23171298126025950 };

static const int64_t M1m0m1[39] = { 42889592454213, -38613546049413, 98927946445939, 159274531969225, 129843115205318, -142640526093336, -160002536810323, -124373814588059, 122168037038185, 25915857274340, 250993309932452, 50452177061043, -63833496248514, -2646854321539, -102683817792963, -57164983692810, 64465680567593, 43433652183805, 28751000515990, 123991539707981, -33080645658854, 5816532679478, -30072637399839, -107946804573593, -71743064095376, 87350653471859, 84459620730033, 51963366872845, -64859609593497, 10095861528762, -114690009636118, -34222492641685, 52315994089742, 8405282105077, 45636479861747, 66185455149106, -46057294744871, -43142338468456, -12167301310285 };

static const int64_t M1m0m2[39] = { 66161291317708, -11633065358957, 60145274799679, 215893609147186, 143486128190752, -174701306943718, -168919241460066, -103926733745689, 129719219186994, -20191723057524, 229380019272236, 68444985283371, -104631988179484, -16810564210154, -91272959723495, -132370910298212, 92114589489742, 86284676936912, 24334602620569, 162821550585630, -42889592454213, 38613546049413, -98927946445939, -159274531969225, -129843115205318, 142640526093336, 160002536810323, 124373814588059, -122168037038185, -25915857274340, -250993309932452, -50452177061043, 63833496248514, 2646854321539, 102683817792963, 57164983692810, -64465680567593, -43433652183805, -28751000515990 };

static const int64_t M1_m0m1[39] = { -2526917224932936, 10594078791460322, -19626102997218277, 21677568104734336, -21553779002620666, 10736648444256464, -28014443461005362, 10108847571959403, -2586774174651284, -10205648708705305, -13388083876899400, -3720469861644836, 7107028875535823, -12795839180983433, -5743628246593857, -23897314350696094, -25355411584727795, -8672745064113158, -19389836450223024, -2334257263604017, -19004530801819400, -28776698613833870, 13514486923054053, 4797186195628242, -458147184628610, 7735670518136496, 19986002644049269, 10180214369834978, 27337812745517482, -8709961372314972, -13470584492078204, -19979366068460707, -5877520716918858, -7170960361523234, 26051155604094579, 17078924182981792, 17177531164251342, -11091709631371654, -833304197344285 };

static const int64_t M1_m0m2[39] = { 1980264584674832, -14504196810260196, -27028973846108106, 26434424627707484, 916294369257220, -15471341036272992, -3943208269134570, 15668368279294012, 17381968546892972, -18608874274334024, -9087628034807560, 3929935117957446, 11755041433837716, -21686876295917500, 19955282829738778, 1870948653000384, -34355062328502684, -13845377756220660, 1666608394688570, 6115478097127239, 2526917224932936, -10594078791460322, 19626102997218277, -21677568104734336, 21553779002620666, -10736648444256464, 28014443461005362, -10108847571959403, 2586774174651284, 10205648708705305, 13388083876899400, 3720469861644836, -7107028875535823, 12795839180983433, 5743628246593857, 23897314350696094, 25355411584727795, 8672745064113158, 19389836450223024 };

static inline void mtoep8(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	SCHOOLBOOK(N/8)

static inline void m1toep8(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1SCHOOLBOOK(N/8)


static inline void mtoep9(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP22TOP(N/4, mtoep8)

static inline void m1toep9(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP22TOP(N/4, m1toep8)


static inline void mtoep10(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP22TOP(N/2, mtoep9)

static inline void m1toep10(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP22TOP(N/2, m1toep9)


static inline void toeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	TOEP22TOP(N, mtoep10)

static inline void ptoeplitz_vm(__int128* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	pTOEP22TOP(N, mtoep10)

static inline void m1toep20(int64_t* restrict rop, const int64_t* restrict vect, const int64_t* restrict matr)
	M1TOEP22TOP(N, m1toep10)


static inline void mtoeplitz_vm0(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[0] + N/2);
	mtoep10(t1, vect, M0m0m1);
	mtoep10(t2, vect + N/2, M0m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


static inline void mtoeplitz_vm1(__int128* restrict rop, const int64_t* restrict vect)
{
	__int128 t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2];
	for(int i = 0; i < N/2; i++)
	{
		v0p1[i] = vect[i] + vect[i + N/2];
	}
	mtoep10(t0, v0p1, M[1] + N/2);
	mtoep10(t1, vect, M1m0m1);
	mtoep10(t2, vect + N/2, M1m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}


// Utility function to extract the lower 64 bits of each vector coefficient
static inline void m1toeplitz_vm(int64_t* restrict rop, const __int128* restrict vect)
{
	int64_t t0[N/2], t1[N/2], t2[N/2];
	int64_t v0p1[N/2], v[N];
	for(int i = 0; i < N/2; i++)
	{
		v[i] = vect[i];
		v[i + N/2] = vect[i + N/2];
		v0p1[i] = v[i] + v[i + N/2];
	}
	m1toep10(t0, v0p1, M1 + N/2);
	m1toep10(t1, v, M1_m0m1);
	m1toep10(t2, v + N/2, M1_m0m2);
	for(int i = 0; i < N/2; i++)
	{
		rop[i] = t0[i] - t2[i];
		rop[i + N/2] = t0[i] - t1[i];
	}
}

void (* const multbym[2]) (__int128* restrict rop, const int64_t* restrict vect) = { mtoeplitz_vm0, mtoeplitz_vm1 };

